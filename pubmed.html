
<style type="text/css" >

.LiTitle{
    font-size: 20px;
}

.LiAuthor{
    font-style: italic;
}

ul {
    margin-top: 30px;
}

 
</style>

<div id="articles"></div>


<script>
var finalIDs = "";
var finalArticles = [];

var fetchIDs = new XMLHttpRequest();
fetchIDs.onreadystatechange = function() {
    if (fetchIDs.readyState == XMLHttpRequest.DONE) {
        var xmlListofID = fetchIDs.responseXML;
        var tempIDs = xmlListofID.getElementsByTagName("IdList");
        console.log(tempIDs);
        for (var i = 0; i < 10; i++){
         	 finalIDs = finalIDs + tempIDs[0].children[i].innerHTML + ",";
        }
        console.log(finalIDs);
        console.log('https://eutils.ncbi.nlm.nih.gov/entrez/eutils/epost.fcgi?db=pubmed&id='+ finalIDs);

        var fetchMeta = new XMLHttpRequest();
        fetchMeta.onreadystatechange = function(){
        	if (fetchMeta.readyState == XMLHttpRequest.DONE) {
        		var xmlWebEnv = fetchMeta.responseXML;
        		var queryKey = xmlWebEnv.getElementsByTagName("QueryKey")[0].innerHTML;
        		var tempWebEnv = xmlWebEnv.getElementsByTagName("WebEnv")[0].innerHTML;

        		console.log(xmlWebEnv);

        		console.log(queryKey);
        		console.log(tempWebEnv);

                var fetchArticles = new XMLHttpRequest();
                fetchArticles.onreadystatechange = function(){
                    if (fetchArticles.readyState == XMLHttpRequest.DONE) {
                        var xmlArticles = fetchArticles.responseXML;
                        var tempArticles = xmlArticles.getElementsByTagName("DocSum");
                        console.log(xmlArticles);
                        console.log(tempArticles);
                        var tempJSON;


                        for (let j = 0; j < tempArticles.length; j++){
                            tempJSON = {};
                            //tempJSON["Id"] = tempArticles[j].children[0].innerHTML;
                            tempJSON["Date"] = tempArticles[j].children[1].innerHTML;

                            var tempAuthors = tempArticles[j].children[4].children;
                            var listAuthors = "";

                            for (let k = 0; k < tempAuthors.length; k++){
                                listAuthors = listAuthors + tempAuthors[k].innerHTML + ", ";
                            }
                            listAuthors = listAuthors.substring(0, listAuthors.length - 2);

                            tempJSON["Author"] = listAuthors;
                            tempJSON["Title"] = tempArticles[j].children[6].innerHTML;
                            tempJSON["Journal"] = tempArticles[j].children[23].innerHTML;
                            tempJSON["URL"] = "https://www.ncbi.nlm.nih.gov/pubmed/" + tempArticles[j].children[0].innerHTML;

                            finalArticles.push(tempJSON);

                            tempNode = document.createElement("ul");
                            var LiDate = document.createElement("li");
                            var LiTitle = document.createElement("li");
                            var LiAuthor = document.createElement("li");
                            var LiJournal = document.createElement("li");

                            var tempURL = "https://www.ncbi.nlm.nih.gov/pubmed/" + tempArticles[j].children[0].innerHTML;
                            var tempTitle = (tempArticles[j].children[6].innerHTML).link(tempURL);
                            var finalTitle = document.createElement("b");
                            finalTitle.innerHTML = tempTitle;

                            LiDate.appendChild(document.createTextNode(tempArticles[j].children[1].innerHTML));
                            LiTitle.appendChild(finalTitle);
                            LiAuthor.appendChild(document.createTextNode(listAuthors));
                            LiJournal.appendChild(document.createTextNode(tempArticles[j].children[23].innerHTML));

                            LiDate.classList.add('LiDate');
                            LiTitle.classList.add('LiTitle');
                            LiAuthor.classList.add('LiAuthor');
                            LiJournal.classList.add('LiJournal');

                            tempNode.appendChild(LiTitle);
                            tempNode.appendChild(LiDate);
                            tempNode.appendChild(LiAuthor);
                            tempNode.appendChild(LiJournal);

                            document.getElementById("articles").appendChild(tempNode);
                        }

                        console.log(finalArticles);

                    }
                }
                fetchArticles.open('GET', 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed&query_key=' + queryKey + '&WebEnv=' + tempWebEnv, true);
                fetchArticles.send(null);

        	}
        }
        fetchMeta.open('GET','https://eutils.ncbi.nlm.nih.gov/entrez/eutils/epost.fcgi?db=pubmed&id='+ finalIDs, true);
        fetchMeta.send(null);
    }
}
fetchIDs.open('GET', 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=(Department%20of%20Anesthesiology%2C%20Pharmacology%20%26%20Therapeutics%5BAffiliation%5D)%20AND%20University%20of%20British%20Columbia%5BAffiliation%5D', true);
fetchIDs.send(null);

</script>
